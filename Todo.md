# boot设计
## 系统初始化
    时钟系统：
        正确配置内部/外部时钟（HSI， HSE， PLL），确保MCU运行在预期频率。
    看门狗：
        初始化独立看门狗（IWDG）和/或窗口看门狗（WWDG），防止程序卡死在Boot阶段。
    基本外设：
        初始化用于通信和指示的GPIO（如LED， 按键）、调试串口（UART）等。
    Flash接口：
        解锁、配置Flash读写接口，为固件烧录做准备
## 通信接口
    协议化通信：
        实现YMODEM/XMODEM协议
## Flash编程
    擦除目标区域：
        安全地擦除存放App的Flash扇区。
    编程Flash：
        将接收到的固件数据（通常是bin或hex文件解析后的原始数据）写入目标Flash地址。
    写入校验：
        支持“读回校验”，即写入后立刻读取，与源数据对比，确保编程无误。
## 固件跳转
    完整性/有效性校验：
        在跳转到应用程序（App）前，必须对App进行校验。
            栈指针检查：
                检查App中断向量表的第一个字（初始栈指针）是否在有效的RAM范围内。
            复位向量检查：
                检查第二个字（复位向量）是否指向合法的程序地址。
            CRC校验：
                计算App区域的CRC值，与预先存储在校验区的正确CRC值对比。不通过则不跳转，防止运行损坏的固件。
    延迟跳转：
        在触发条件满足时（如按键按下），提供一个短暂的等待时间（如3秒），允许用户取消跳转并强制进入Bootloader。
    应用程序跳转：
        关闭中断，进行必要的硬件反初始化（如关闭外设），然后跳转到App的入口地址。

上电/复位
     |
     v
[ Bootloader 开始 ]
     |
     v
[ 硬件初始化 (时钟，看门狗，GPIO，Flash) ]
     |
     v
[ 检查启动条件 ] <---------------------+
     |                                  |
     |(条件不满足)                      |(条件满足：如按键按下/升级标志)
     v                                  |
[ 校验App (SP， PC， CRC) ]              |
     |                                  |
     |(校验成功)                        |
     v                                  |
[ 跳转到App ]                          |
     |                                  |
     +----------------------------------+
     |
     v
[ 进入Bootloader主循环 ]
     |
     v
[ 等待主机连接/命令 ]
     |
     |<--- [ 支持UART， USB， CAN等 ]
     |
     v
[ 解析命令帧 ]
     |
     +-- [ 获取信息命令 (版本， ID) ]
     +-- [ 擦除Flash命令 ]
     +-- [ 写入数据命令 (支持加密/签名验证) ]
     +-- [ 跳转命令 ]
     +-- [ 其他高级命令... ]