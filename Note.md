# 一、芯片启动
- ld文件定义多个变量供c库使用，主要是各个段的起始和结束地址；
- ld中定义的堆栈大小是编译时检查使用，实际程序不会用到；
- ld中的estack和bss_end分别对应着栈顶和堆起始地址，实际堆栈溢出cpu是不检测的，靠用户实现；
- 启动文件定义中断向量表；初始化msp和pc指针，指定中断向量表（每个中断函数地址）；初始化时钟；搬运data段、bss段；跳转main函数；
---
# 二、外设初始化
## 2.1 systemtick初始化
- 配置系统定时器（重载值、中断、使能）、配置nvic(开启系统时钟中断)、系统定时器isr（hal库tick++）；该配置会在rcc配置完重新配置一便，因为cpu上电先用的hci**cpu核心外设似乎不需要RCC配置，包括NVIC和系统时钟定时器**
## 2.2 AFIO配置
afio可以把一些复用功能重新映射到其他引脚上，可控制sw、jtag、spi、uart、exit等；同一个一脚可以连接多个外设，所以外设引脚冲突时，外设rcc只能使能其中一个，或者afio重映射到其他引脚，可映射的引脚是固定的不是随意的；
## 2.3 GPIO配置
- 速度指的是电平攀升或者下降的时间，使用低速应用时可以适当降低速度；
- 每个复用功能都有自己的gpio配置，可查看用户手册；
## 2.4 外部中断配置
- 触发（上升、下降、全）、exitlin、使能、中断/事件；
## 2.5UART配置
### 2.5.1底层小结
uart发送就是向dr寄存器写数据，然后读状态寄存器查看是否发送完成，发送完成可产生中断；写操作自动清零发送结束中断
uart接受就是读取rxne状态位，状态位就绪后读取dr寄存器；rxnc可产生中断；读操作自动清除rxne中断；
### 2.5.2驱动小结
分层设计：  
1.状态标志，包括锁定状态、运行状态；  
2.配置参数，包括波特率、校验位等；  
3.驱动缓存，tx和rx buffer；  
4.注册回调，供用户拓展；
### 2.5.3配置小结
- 波特率、停止位、校验位、流控；
- 中断使能、nvic通道使能，外设使能，rcc使能；
- dma配置
## 2.6nvic配置
- 配置优先级组
- 为需要使用的中断配置优先级
## 2.7 定时器
### 2.7.1 时基单元
- 预分频器：多少次时钟基数+1
- 自动重装器：达到存储的计数值时清空计数器
- 计数器：按照预分屏器设置自增、自减、中间对齐
- 中断（标志手动清零）：自动重装器重装时、输入捕获和输出比较匹配时、外部时钟输入边沿变化时
### 2.7.2 基本功能
- 内外时钟源选择：内部外设总线时钟、内部：trgi(其他定时器的trgo（itr）)、外部：tim_etr引脚 （可配置滤波、分频、边沿检测）、外部：tim_ch引脚；不同外部引脚连接内部的单元不同，所以功能不同
- 输出比较
- 输入捕获
- 主从触发：也就是产生事件，事件触发别的外设工作，全程不需要cpu参与，和外部中断触发事件类似，是stm32硬件自动化的功能
- 编码器计数
- 缓冲寄存器：自动重装、预分频、比较等，会在一个周期后再加载值到实际的运行寄存器
